name: Build and publish image to docker hub
on:
    [workflow_dispatch]
jobs:
    publish_image:
        runs-on: ubuntu-latest
        steps:
            - name: checkout
              uses: actions/checkout@v4
            - name: build image
              run: |
                docker build -t ciaa/mlops:latest \
                --secret id=aws_access_key,src=${{ secrets.AWS_ACCESS_KEY_ID }} \
                --secret id=aws_secret_key,src=${{ secrets.AWS_SECRET_ACCESS_KEY }} . 
            - name: push image to docker hub
              run: |
                docker login -u ${{ secrets.DOCKER_HUB_USERNAME }} -p ${{ secrets.DOCKER_HUB_TOKEN }}
                docker push ciaa/mlops:latest
